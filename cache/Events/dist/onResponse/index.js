(()=>{"use strict";var e={};(()=>{e.d=(t,r)=>{for(var a in r){if(e.o(r,a)&&!e.o(t,a)){Object.defineProperty(t,a,{enumerable:true,get:r[a]})}}}})();(()=>{e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{e.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof e!=="undefined")e.ab=__dirname+"/";var t={};e.r(t);e.d(t,{handler:()=>handler});const getActions=e=>{const t="{{secrets.wpUrl}}";const r={"WP-API-KEY":"{{secrets.wpapiKey}}"};return[[/\/order\/(\d+)\/shipping\/([^\/]+)\/([^\/]+)/,async e=>{try{const[a,s,n,o]=e;const i=await axios.get(`${t}/wp-json/wc/v3/orders/${parseInt(s)}`,{headers:r,params:{customer:"{{variables.publicUserId}}"}});if(!i.data||i.data.customer_id.toString()!=="{{variables.publicUserId}}"){return{error:"Order not found or access denied"}}if(i.data.status!=="processing"){return{error:"Order shipping details can only be modified when order is processing"}}const c=await axios.put(`${t}/wp-json/wc/v3/orders/${s}`,{shipping:{[n]:o}},{headers:r});return{data:{id:c.data.id,shipping:c.data.shipping}}}catch(e){return{error:"Failed to update shipping details: "+e.message}}}],[/\/?orders\s*(\d+)?/,async e=>{try{const a=e[1]?parseInt(e[1]):1;const s=await axios.get(`${t}/wp-json/wc/v3/orders`,{headers:r,params:{customer:"{{variables.publicUserId}}",per_page:a,orderby:"date",order:"desc"}});const n=s.data.map((({id:e,status:t,date_created:r,total:a,currency:s,payment_method:n,shipping_total:o,line_items:i,shipping:c,billing:d})=>({id:e,status:t,date_created:r,total:a,currency:s,payment_method:n,shipping_total:o,line_items:i.map((({name:e,quantity:t,total:r,price:a,sku:s})=>({name:e,quantity:t,total:r,price:a,sku:s}))),shipping:c,billing:d})));return{data:n}}catch(e){return{error:"Failed to fetch orders: "+e.message}}}],[/\/?wpSearch\("([^"]*)"(?:\s*,\s*(\d+))?(?:\s*,\s*"([^"]*)")?(?:\s*,\s*(\d+(?:\.\d+)?))?\)/,async e=>{const a=e[1]||" ";const s=e[2]||10;const n=e[3]?e[3].split(",").map((e=>e.trim())):undefined;const o=e[4];try{const e={query:a,kbId:openkbs.kbId,limit:s,...n&&{itemTypes:n},...o&&{maxPrice:o}};const i=await axios.get(`${t}/wp-json/openkbs/v1/search`,{headers:r,params:e});return{data:i.data}}catch(e){return{error:e.response?.data||e.message}}}],[/\/?webpageToText\("(.*)"\)/,async e=>{try{let t=await openkbs.webpageToText(e[1]);if(t?.content?.length>5e3){t.content=t.content.substring(0,5e3)}return{data:t}}catch(e){return{error:e.response.data}}}],[/\/?documentToText\("(.*)"\)/,async e=>{try{let t=await openkbs.documentToText(e[1]);if(t?.text?.length>5e3){t.text=t.text.substring(0,5e3)}return{data:t}}catch(e){return{error:e.response.data}}}],[/\/?imageToText\("(.*)"\)/,async e=>{try{let t=await openkbs.imageToText(e[1]);if(t?.detections?.[0]?.txt){t={detections:t?.detections?.[0]?.txt}}return{data:t}}catch(e){return{error:e.response.data}}}]]};const handler=async e=>{const t={_meta_actions:["REQUEST_CHAT_MODEL"]};const r=getActions(t);const a=e.payload.messages[e.payload.messages.length-1].content;const s=r.reduce(((e,[t,r])=>{const s=[...a.matchAll(new RegExp(t,"g"))];s.forEach((t=>{e.push(r(t))}));return e}),[]);if(s.length>0){try{const e=await Promise.all(s);return{type:"RESPONSE",data:e,...t}}catch(e){return{type:"ERROR",error:e.message,...t}}}return{type:"CONTINUE"}};module.exports=t})();